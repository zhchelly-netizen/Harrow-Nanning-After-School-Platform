<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç³»ç»Ÿè¯Šæ–­ - å“ˆç½—å—å®é—¨æˆ·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            padding: 2rem;
            background: #f5f5f5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            color: #152242;
            margin-bottom: 2rem;
        }
        
        .test-section {
            background: white;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .test-section h2 {
            color: #152242;
            margin-bottom: 1rem;
            font-size: 1.25rem;
        }
        
        .status {
            display: inline-block;
            padding: 0.5rem 1rem;
            border-radius: 50px;
            font-weight: 600;
            margin-bottom: 1rem;
        }
        
        .status.success {
            background: #10b981;
            color: white;
        }
        
        .status.error {
            background: #dc2626;
            color: white;
        }
        
        .status.warning {
            background: #f59e0b;
            color: white;
        }
        
        .test-result {
            padding: 0.75rem;
            margin: 0.5rem 0;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }
        
        .test-result.pass {
            background: #d1fae5;
            border-left: 4px solid #10b981;
        }
        
        .test-result.fail {
            background: #fee2e2;
            border-left: 4px solid #dc2626;
        }
        
        button {
            padding: 0.75rem 1.5rem;
            background: #152242;
            color: white;
            border: none;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            margin: 0.5rem 0.5rem 0.5rem 0;
        }
        
        button:hover {
            background: #1e3158;
        }
        
        .code-block {
            background: #1e293b;
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 8px;
            overflow-x: auto;
            margin: 1rem 0;
        }
        
        .fix-button {
            background: #10b981;
        }
        
        .fix-button:hover {
            background: #059669;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” ç³»ç»Ÿè¯Šæ–­å·¥å…·</h1>
        
        <!-- æµ‹è¯• 1: i18n ç³»ç»Ÿ -->
        <div class="test-section">
            <h2>1ï¸âƒ£ i18n å›½é™…åŒ–ç³»ç»Ÿ</h2>
            <div id="i18n-status" class="status warning">æ£€æŸ¥ä¸­...</div>
            <div id="i18n-results"></div>
            <button onclick="testI18n()">é‡æ–°æµ‹è¯•</button>
            <button onclick="testLanguageSwitch()" class="fix-button">æµ‹è¯•è¯­è¨€åˆ‡æ¢</button>
        </div>
        
        <!-- æµ‹è¯• 2: CCA æ•°æ® -->
        <div class="test-section">
            <h2>2ï¸âƒ£ CCA è¯¾ç¨‹æ•°æ®</h2>
            <div id="cca-status" class="status warning">æ£€æŸ¥ä¸­...</div>
            <div id="cca-results"></div>
            <button onclick="testCCAData()">é‡æ–°æµ‹è¯•</button>
        </div>
        
        <!-- æµ‹è¯• 3: äº‹ä»¶ç³»ç»Ÿ -->
        <div class="test-section">
            <h2>3ï¸âƒ£ è¯­è¨€åˆ‡æ¢äº‹ä»¶ç³»ç»Ÿ</h2>
            <div id="event-status" class="status warning">æ£€æŸ¥ä¸­...</div>
            <div id="event-results"></div>
            <button onclick="testEventSystem()">é‡æ–°æµ‹è¯•</button>
        </div>
        
        <!-- æµ‹è¯• 4: ç®¡ç†åå° -->
        <div class="test-section">
            <h2>4ï¸âƒ£ ç®¡ç†åå°ç¿»è¯‘è®¿é—®</h2>
            <div id="admin-status" class="status warning">æ£€æŸ¥ä¸­...</div>
            <div id="admin-results"></div>
            <button onclick="testAdminAccess()">é‡æ–°æµ‹è¯•</button>
            <button onclick="window.open('admin.html', '_blank')">æ‰“å¼€ç®¡ç†åå°</button>
        </div>
        
        <!-- æµ‹è¯• 5: æ§åˆ¶å°é”™è¯¯ -->
        <div class="test-section">
            <h2>5ï¸âƒ£ æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯</h2>
            <div id="console-status" class="status warning">æ£€æŸ¥ä¸­...</div>
            <div id="console-results"></div>
            <button onclick="checkConsoleErrors()">æ£€æŸ¥æ§åˆ¶å°</button>
        </div>
        
        <!-- å¿«é€Ÿä¿®å¤ -->
        <div class="test-section">
            <h2>ğŸ”§ å¿«é€Ÿä¿®å¤</h2>
            <button onclick="clearCache()" class="fix-button">æ¸…é™¤æµè§ˆå™¨ç¼“å­˜</button>
            <button onclick="reloadAll()" class="fix-button">å¼ºåˆ¶åˆ·æ–°æ‰€æœ‰èµ„æº</button>
            <button onclick="window.open('cca-planning.html', '_blank')">æ‰“å¼€ CCA é¡µé¢æµ‹è¯•</button>
        </div>
    </div>

    <script src="scripts/i18n.js"></script>
    <script src="scripts/cca-data.js"></script>
    
    <script>
        let testResults = {
            i18n: false,
            cca: false,
            events: false,
            admin: false
        };
        
        // æ•è·æ§åˆ¶å°é”™è¯¯
        let consoleErrors = [];
        const originalError = console.error;
        console.error = function(...args) {
            consoleErrors.push(args.join(' '));
            originalError.apply(console, args);
        };
        
        // æµ‹è¯• 1: i18n ç³»ç»Ÿ
        function testI18n() {
            const results = [];
            let allPass = true;
            
            // æ£€æŸ¥ i18n å¯¹è±¡æ˜¯å¦å­˜åœ¨
            if (typeof i18n !== 'undefined') {
                results.push({ pass: true, msg: 'âœ… i18n å¯¹è±¡å·²åŠ è½½' });
            } else {
                results.push({ pass: false, msg: 'âŒ i18n å¯¹è±¡æœªåŠ è½½' });
                allPass = false;
            }
            
            // æ£€æŸ¥ translations å¯¹è±¡
            if (typeof i18n !== 'undefined' && i18n.translations) {
                results.push({ pass: true, msg: `âœ… translations å¯¹è±¡å­˜åœ¨` });
                
                const zhKeys = Object.keys(i18n.translations.zh || {});
                const enKeys = Object.keys(i18n.translations.en || {});
                results.push({ pass: true, msg: `âœ… ä¸­æ–‡ç¿»è¯‘: ${zhKeys.length} ä¸ªé”®` });
                results.push({ pass: true, msg: `âœ… è‹±æ–‡ç¿»è¯‘: ${enKeys.length} ä¸ªé”®` });
            } else {
                results.push({ pass: false, msg: 'âŒ translations å¯¹è±¡ä¸å­˜åœ¨' });
                allPass = false;
            }
            
            // æ£€æŸ¥ t() æ–¹æ³•
            if (typeof i18n !== 'undefined' && typeof i18n.t === 'function') {
                const testKey = i18n.t('heroTitle');
                if (testKey && testKey !== 'heroTitle') {
                    results.push({ pass: true, msg: `âœ… t() æ–¹æ³•å·¥ä½œæ­£å¸¸: "${testKey}"` });
                } else {
                    results.push({ pass: false, msg: 'âŒ t() æ–¹æ³•è¿”å›å¼‚å¸¸' });
                    allPass = false;
                }
            } else {
                results.push({ pass: false, msg: 'âŒ t() æ–¹æ³•ä¸å­˜åœ¨' });
                allPass = false;
            }
            
            // æ£€æŸ¥å½“å‰è¯­è¨€
            if (typeof i18n !== 'undefined' && typeof i18n.getCurrentLanguage === 'function') {
                const lang = i18n.getCurrentLanguage();
                results.push({ pass: true, msg: `âœ… å½“å‰è¯­è¨€: ${lang}` });
            }
            
            displayResults('i18n', results, allPass);
            testResults.i18n = allPass;
        }
        
        // æµ‹è¯• 2: CCA æ•°æ®
        function testCCAData() {
            const results = [];
            let allPass = true;
            
            if (typeof CCA_COURSES !== 'undefined') {
                results.push({ pass: true, msg: 'âœ… CCA_COURSES å¯¹è±¡å·²åŠ è½½' });
                
                const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday'];
                days.forEach(day => {
                    if (CCA_COURSES[day]) {
                        results.push({ pass: true, msg: `âœ… ${day}: ${CCA_COURSES[day].length} é—¨è¯¾ç¨‹` });
                    } else {
                        results.push({ pass: false, msg: `âŒ ${day}: æ— æ•°æ®` });
                        allPass = false;
                    }
                });
            } else {
                results.push({ pass: false, msg: 'âŒ CCA_COURSES å¯¹è±¡æœªåŠ è½½' });
                allPass = false;
            }
            
            if (typeof ELITE_SCHEDULES !== 'undefined') {
                const count = Object.keys(ELITE_SCHEDULES).length;
                results.push({ pass: true, msg: `âœ… ELITE_SCHEDULES: ${count} ä¸ªé¡¹ç›®` });
            } else {
                results.push({ pass: false, msg: 'âŒ ELITE_SCHEDULES æœªåŠ è½½' });
                allPass = false;
            }
            
            displayResults('cca', results, allPass);
            testResults.cca = allPass;
        }
        
        // æµ‹è¯• 3: äº‹ä»¶ç³»ç»Ÿ
        function testEventSystem() {
            const results = [];
            let allPass = true;
            
            // æµ‹è¯•äº‹ä»¶ç›‘å¬
            let eventFired = false;
            const testListener = (e) => {
                eventFired = true;
                results.push({ pass: true, msg: `âœ… äº‹ä»¶è§¦å‘æˆåŠŸï¼Œdetail.lang = ${e.detail.lang}` });
            };
            
            document.addEventListener('languageChanged', testListener);
            
            // è§¦å‘æµ‹è¯•äº‹ä»¶
            window.dispatchEvent(new CustomEvent('languageChanged', { 
                detail: { lang: 'test' } 
            }));
            
            setTimeout(() => {
                if (eventFired) {
                    results.push({ pass: true, msg: 'âœ… äº‹ä»¶ç³»ç»Ÿå·¥ä½œæ­£å¸¸' });
                } else {
                    results.push({ pass: false, msg: 'âŒ äº‹ä»¶æœªè§¦å‘' });
                    allPass = false;
                }
                
                document.removeEventListener('languageChanged', testListener);
                displayResults('event', results, allPass);
                testResults.events = allPass;
            }, 100);
        }
        
        // æµ‹è¯• 4: ç®¡ç†åå°è®¿é—®
        function testAdminAccess() {
            const results = [];
            let allPass = true;
            
            if (typeof i18n !== 'undefined' && i18n.translations) {
                results.push({ pass: true, msg: 'âœ… å¯ä»¥é€šè¿‡ i18n.translations è®¿é—®ç¿»è¯‘æ•°æ®' });
                
                // æ¨¡æ‹Ÿç®¡ç†åå°çš„è®¿é—®æ–¹å¼
                try {
                    const testData = JSON.parse(JSON.stringify(i18n.translations));
                    results.push({ pass: true, msg: 'âœ… å¯ä»¥å…‹éš†ç¿»è¯‘æ•°æ®ï¼ˆç®¡ç†åå°éœ€è¦ï¼‰' });
                } catch (e) {
                    results.push({ pass: false, msg: `âŒ å…‹éš†æ•°æ®å¤±è´¥: ${e.message}` });
                    allPass = false;
                }
            } else {
                results.push({ pass: false, msg: 'âŒ æ— æ³•è®¿é—® i18n.translations' });
                allPass = false;
            }
            
            displayResults('admin', results, allPass);
            testResults.admin = allPass;
        }
        
        // æ£€æŸ¥æ§åˆ¶å°é”™è¯¯
        function checkConsoleErrors() {
            const results = [];
            
            if (consoleErrors.length === 0) {
                results.push({ pass: true, msg: 'âœ… æ²¡æœ‰æ§åˆ¶å°é”™è¯¯' });
            } else {
                results.push({ pass: false, msg: `âŒ å‘ç° ${consoleErrors.length} ä¸ªé”™è¯¯:` });
                consoleErrors.forEach((err, i) => {
                    results.push({ pass: false, msg: `  ${i + 1}. ${err}` });
                });
            }
            
            displayResults('console', results, consoleErrors.length === 0);
        }
        
        // æµ‹è¯•è¯­è¨€åˆ‡æ¢
        function testLanguageSwitch() {
            if (typeof i18n !== 'undefined' && typeof i18n.switchLanguage === 'function') {
                const before = i18n.getCurrentLanguage();
                i18n.switchLanguage();
                const after = i18n.getCurrentLanguage();
                
                alert(`è¯­è¨€åˆ‡æ¢æµ‹è¯•:\nåˆ‡æ¢å‰: ${before}\nåˆ‡æ¢å: ${after}\n\n${before !== after ? 'âœ… åˆ‡æ¢æˆåŠŸ' : 'âŒ åˆ‡æ¢å¤±è´¥'}`);
                
                // åˆ‡æ¢å›å»
                setTimeout(() => {
                    i18n.switchLanguage();
                }, 1000);
            } else {
                alert('âŒ i18n.switchLanguage() æ–¹æ³•ä¸å­˜åœ¨');
            }
        }
        
        // æ˜¾ç¤ºç»“æœ
        function displayResults(testName, results, allPass) {
            const statusEl = document.getElementById(`${testName}-status`);
            const resultsEl = document.getElementById(`${testName}-results`);
            
            statusEl.className = `status ${allPass ? 'success' : 'error'}`;
            statusEl.textContent = allPass ? 'âœ… é€šè¿‡' : 'âŒ å¤±è´¥';
            
            resultsEl.innerHTML = results.map(r => 
                `<div class="test-result ${r.pass ? 'pass' : 'fail'}">${r.msg}</div>`
            ).join('');
        }
        
        // æ¸…é™¤ç¼“å­˜
        function clearCache() {
            if (confirm('ç¡®å®šè¦æ¸…é™¤æµè§ˆå™¨ç¼“å­˜å—ï¼Ÿè¿™å°†åˆ·æ–°é¡µé¢ã€‚')) {
                localStorage.clear();
                sessionStorage.clear();
                location.reload(true);
            }
        }
        
        // å¼ºåˆ¶åˆ·æ–°
        function reloadAll() {
            location.reload(true);
        }
        
        // é¡µé¢åŠ è½½æ—¶è¿è¡Œæ‰€æœ‰æµ‹è¯•
        window.addEventListener('load', () => {
            setTimeout(() => {
                testI18n();
                testCCAData();
                testEventSystem();
                testAdminAccess();
                checkConsoleErrors();
            }, 500);
        });
    </script>
</body>
</html>
