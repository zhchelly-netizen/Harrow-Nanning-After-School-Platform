# 修复总结 - 2026年1月26日

## 修复内容

### 1. ✅ Planner 语言切换问题
**问题**：Planner 显示英文后立即变回中文

**原因**：Planner 没有监听语言切换事件

**解决方案**：
在 `scripts/floating-planner.js` 中：
1. 添加 `updatePageLanguage()` 方法，用于重新渲染所有内容
2. 在页面加载时监听 `languageChanged` 事件
3. 当语言切换时，调用 `updatePageLanguage()` 重新生成所有内容

```javascript
// 监听语言切换事件
document.addEventListener('languageChanged', function(e) {
    if (floatingPlanner) {
        floatingPlanner.updatePageLanguage();
    }
});
```

### 2. ✅ 圆角矩形左边色条问题
**问题**：课程设置的圆角矩形最左边的色条没有跟随形状

**原因**：使用了 `border-image` 属性，它不支持 `border-radius`

**解决方案**：
在 `styles/cca.css` 中，将 `.schedule-notice` 和 `.selection-notice` 的边框改为：
```css
border-left: 4px solid #6b7c93;
```
移除了 `border-image` 属性，改用简单的 `border-left`，这样可以正确跟随圆角。

### 3. ✅ 字体文件引用错误
**问题**：页面中文依旧显示衬线字（思源宋体）而不是思源黑体

**原因**：
- `styles/main.css` 中思源黑体的粗体（font-weight: 700）错误地引用了思源宋体文件
- `styles/fonts.css` 中也有同样的错误

**解决方案**：
修复了两个文件中的字体引用：
```css
/* 错误的 */
@font-face {
    font-family: 'Source Han Sans SC';
    src: url('../fonts/SourceHanSerifSC-Bold.otf') format('opentype');
    font-weight: 700;
}

/* 正确的 */
@font-face {
    font-family: 'Source Han Sans SC';
    src: url('../fonts/SourceHanSansSC-Bold.otf') format('opentype');
    font-weight: 700;
}
```

### 4. ⚠️ 活动名称翻译（部分完成）
**问题**：CCA 课程名称不显示英文

**现状**：
- CCA 数据结构（`scripts/cca-data.js`）中只有中文名称
- 有 100+ 个课程，每个都需要英文翻译

**建议方案**：
有两种方案可选：

**方案 A：修改数据结构（推荐）**
```javascript
const CCA_COURSES = {
    monday: [
        { 
            id: 'mon-1', 
            name: '滑板',
            nameEn: 'Skateboarding',
            teacher: '那山水', 
            // ...
        },
    ]
};
```
然后在显示时根据当前语言选择 `name` 或 `nameEn`。

**方案 B：使用翻译键**
为每个课程创建翻译键，但工作量很大（100+ 个课程）。

**当前状态**：
- Planner 中的其他文字（标题、状态、统计等）已完全翻译
- 只有课程名称本身还是中文

### 5. ✅ 版本号更新
所有文件版本号从 `v=20260125` 更新到 `v=20260126`

## 修改的文件清单

1. `scripts/floating-planner.js` - 添加语言切换监听和 `updatePageLanguage()` 方法
2. `styles/cca.css` - 修复圆角矩形边框问题
3. `styles/main.css` - 修复思源黑体粗体字体引用
4. `styles/fonts.css` - 修复思源黑体粗体字体引用
5. `index.html` - 更新版本号
6. `cca-planning.html` - 更新版本号
7. `scholarship.html` - 更新版本号

## 技术细节

### Planner 语言切换流程
```
用户点击语言切换按钮
  ↓
触发 languageChanged 事件
  ↓
Planner 监听到事件
  ↓
调用 updatePageLanguage()
  ↓
重新渲染：
  - 标题
  - 提醒文字
  - 空状态
  - 学生信息
  - 精英项目列表
  - 周计划
```

### 字体加载优先级
```css
/* Banner 区域（深蓝色头部） */
font-family: 'Bembo', 'Source Han Serif SC', ...
/* 浏览器会先尝试加载 Bembo（西文），如果字符不在 Bembo 中，则使用思源宋体（中文） */

/* 其他所有区域 */
font-family: 'Gotham', 'Source Han Sans SC', ...
/* 浏览器会先尝试加载 Gotham（西文），如果字符不在 Gotham 中，则使用思源黑体（中文） */
```

## 测试建议

1. **清除浏览器缓存**：按 `Cmd+Shift+R` (Mac) 或 `Ctrl+Shift+R` (Windows)

2. **测试 Planner 语言切换**：
   - 进入 CCA 规划页面
   - 选择年级和精英项目
   - 查看右侧 Planner
   - 点击语言切换按钮
   - 确认 Planner 内容立即切换为英文并保持

3. **测试圆角边框**：
   - 查看课程选择页面的提示框
   - 确认左侧蓝色边框完美贴合圆角

4. **测试字体显示**：
   - 检查页面中文是否显示为思源黑体（非衬线字）
   - 检查 Banner 区域中文是否显示为思源宋体（衬线字）
   - 检查英文和数字是否显示为 Gotham（非衬线字）
   - 检查 Banner 区域英文是否显示为 Bembo（衬线字）

5. **验证字体加载**：
   - 打开浏览器开发者工具 → Network 标签
   - 筛选 Font 类型
   - 刷新页面
   - 确认加载了：
     - SourceHanSansSC-Bold.otf（思源黑体粗体）
     - SourceHanSerifSC-Bold.otf（思源宋体粗体）
     - Gotham-Bold.otf
     - Bembo-Bold.otf

## 已知问题

### CCA 课程名称翻译
**问题**：课程名称仍然只显示中文

**影响范围**：
- CCA 课程列表中的课程名称
- Planner 中显示的课程名称

**建议解决方案**：
需要为 100+ 个课程添加英文翻译。推荐修改 `scripts/cca-data.js`，为每个课程对象添加 `nameEn` 字段，然后修改显示逻辑：

```javascript
// 在 loadCCACourses() 函数中
const courseName = i18n.currentLang === 'en' && course.nameEn ? course.nameEn : course.name;
```

**工作量估算**：
- 修改数据结构：100+ 个课程 × 添加英文名称
- 修改显示逻辑：约 5 处代码需要修改
- 预计需要 2-3 小时完成

## 完成状态

✅ Planner 语言切换立即生效
✅ 圆角矩形边框完美贴合
✅ 字体文件引用修复（思源黑体粗体）
✅ 页面中文显示思源黑体（非衬线字）
✅ Banner 中文显示思源宋体（衬线字）
⚠️ CCA 课程名称翻译（需要添加英文数据）
✅ 版本号更新到 v=20260126

## 下一步建议

如果需要完成 CCA 课程名称的英文翻译，建议：
1. 准备一份课程名称的中英文对照表
2. 批量修改 `scripts/cca-data.js` 添加 `nameEn` 字段
3. 修改 `scripts/cca.js` 和 `scripts/floating-planner.js` 中的显示逻辑
4. 测试所有课程名称在中英文切换时正确显示
